<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>1.2 Migration from the Acegi Plugin</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    The Spring Security plugin is a successor to the <a href="http://grails.org/plugin/acegi/" target="blank">Acegi plugin</a>. It does not depend on that plugin, but contains many similarities, so migrating is fairly straightforward.<p class="paragraph"/><h4>Core Similarities and Differences Between Spring Security and Acegi Plugins</h4><p class="paragraph"/>The Spring Security plugin retains many core features of the Acegi plugin:
<ul class="star">
<li>Form-based authentication</li>
<li>Storing users, roles, and optionally requestmaps in the database, with access through domain classes</li>
<li>Guarding URLs with annotations, requestmap domain class, or static configuration</li>
<li>Security tags</li>
<li>Security service</li>
<li>Security events</li>
<li>Ajax login</li>
<li>Basic authentication</li>
<li>Switch User</li>
<li>Channel security</li>
<li>IP address restrictions</li>
</ul><p class="paragraph"/>and in addition adds several new features:
<ul class="star">
<li>Digest authentication</li>
<li>Session Fixation Prevention</li>
<li>Salted passwords</li>
<li>Certificate (x509) login</li>
<li>Hierarchical roles</li>
<li>Account locking and forcing password change</li>
</ul><p class="paragraph"/><h4>Features Not Included in the Spring Security Plugin</h4><p class="paragraph"/>The following features are not included in the Spring Security plugin, but will be available in secondary plugins that will extend and depend on the core plugin:
<ul class="star">
<li>Facebook</li>
<li>OpenID</li>
<li>LDAP</li>
<li>CAS</li>
<li>NTLM</li>
<li>Kerberos</li>
<li>User registration</li>
</ul><p class="paragraph"/><h4>Required Configuration Changes to Your Application</h4><p class="paragraph"/>If you formerly used the Acegi plugin, you will need to change your application configuration settings as follows:
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th>&#160;</th><th><strong class="bold">Spring Security plugin</strong></th><th><strong class="bold">Acegi plugin</strong></th></tr><tr class="table-odd"><td>Enabled by default</td><td><code>true</code></td><td><code>false</code></td></tr><tr class="table-even"><td>Cache UserDetails by default</td><td><code>false</code></td><td><code>true</code></td></tr><tr class="table-odd"><td>Configuration location</td><td><code>grails-app/conf/Config.groovy</code></td><td><code>grails-app/conf/SecurityConfig.groovy</code></td></tr><tr class="table-even"><td>Security service</td><td><code>springSecurityService</code></td><td><code>authenticateService</code></td></tr></table><p class="paragraph"/><h4>Comparing Configuration Attribute Names</h4><p class="paragraph"/>This table summarizes the configuration attribute names in both plugins:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Acegi plugin</strong></th><th><strong class="bold">Spring Security plugin</strong></th></tr><tr class="table-odd"><td>active</td><td>active</td></tr><tr class="table-even"><td>loginUserDomainClass</td><td>userLookup.userDomainClassName</td></tr><tr class="table-odd"><td>userName</td><td>userLookup.usernamePropertyName</td></tr><tr class="table-even"><td>enabled</td><td>userLookup.enabledPropertyName</td></tr><tr class="table-odd"><td>password</td><td>userLookup.passwordPropertyName</td></tr><tr class="table-even"><td>relationalAuthorities</td><td>userLookup.authoritiesPropertyName</td></tr><tr class="table-odd"><td>getAuthoritiesMethod</td><td>N/A</td></tr><tr class="table-even"><td>authorityDomainClass</td><td>authority.className</td></tr><tr class="table-odd"><td>authorityField</td><td>authority.nameField</td></tr><tr class="table-even"><td>authenticationFailureUrl</td><td>failureHandler.defaultFailureUrl</td></tr><tr class="table-odd"><td>ajaxAuthenticationFailureUrl</td><td>failureHandler.ajaxAuthFailUrl</td></tr><tr class="table-even"><td>defaultTargetUrl</td><td>successHandler.defaultTargetUrl</td></tr><tr class="table-odd"><td>alwaysUseDefaultTargetUrl</td><td>successHandler.alwaysUseDefault</td></tr><tr class="table-even"><td>filterProcessesUrl</td><td>apf.filterProcessesUrl</td></tr><tr class="table-odd"><td>key</td><td>anon.key</td></tr><tr class="table-even"><td>userAttribute</td><td>anon.userAttribute</td></tr><tr class="table-odd"><td>loginFormUrl</td><td>auth.loginFormUrl</td></tr><tr class="table-even"><td>forceHttps</td><td>auth.forceHttps</td></tr><tr class="table-odd"><td>ajaxLoginFormUrl</td><td>auth.ajaxLoginFormUrl</td></tr><tr class="table-even"><td>afterLogoutUrl</td><td>logout.afterLogoutUrl</td></tr><tr class="table-odd"><td>errorPage</td><td>adh.errorPage</td></tr><tr class="table-even"><td>ajaxErrorPage</td><td>adh.ajaxErrorPage</td></tr><tr class="table-odd"><td>ajaxHeader</td><td>ajaxHeader</td></tr><tr class="table-even"><td>algorithm</td><td>password.algorithm</td></tr><tr class="table-odd"><td>encodeHashAsBase64</td><td>password.encodeHashAsBase64</td></tr><tr class="table-even"><td>cookieName</td><td>rememberMe.cookieName</td></tr><tr class="table-odd"><td>alwaysRemember</td><td>rememberMe.alwaysRemember</td></tr><tr class="table-even"><td>tokenValiditySeconds</td><td>rememberMe.tokenValiditySeconds</td></tr><tr class="table-odd"><td>parameter</td><td>rememberMe.parameter</td></tr><tr class="table-even"><td>rememberMeKey</td><td>rememberMe.key</td></tr><tr class="table-odd"><td>useLogger</td><td>registerLoggerListener</td></tr><tr class="table-even"><td>useRequestMapDomainClass</td><td>securityConfigType = <code>SecurityConfigType.Requestmap</code></td></tr><tr class="table-odd"><td>requestMapClass</td><td>requestMap.className</td></tr><tr class="table-even"><td>requestMapPathField</td><td>requestMap.urlField</td></tr><tr class="table-odd"><td>requestMapConfigAttributeField</td><td>requestMap.configAttributeField</td></tr><tr class="table-even"><td>useControllerAnnotations</td><td>securityConfigType = <code>SecurityConfigType.Annotation</code></td></tr><tr class="table-odd"><td>controllerAnnotationsMatcher</td><td>controllerAnnotations.matcher</td></tr><tr class="table-even"><td>controllerAnnotationsMatchesLowercase</td><td>controllerAnnotations.lowercase</td></tr><tr class="table-odd"><td>controllerAnnotationStaticRules</td><td>controllerAnnotations.staticRules</td></tr><tr class="table-even"><td>controllerAnnotationsRejectIfNoRule</td><td>rejectIfNoRule</td></tr><tr class="table-odd"><td>requestMapString</td><td>N/A - securityConfigType = <code>SecurityConfigType.InterceptUrlMap</code> is very similar</td></tr><tr class="table-even"><td>realmName</td><td>basic.realmName</td></tr><tr class="table-odd"><td>basicProcessingFilter</td><td>useBasicAuth</td></tr><tr class="table-even"><td>switchUserProcessingFilter</td><td>useSwitchUserFilter</td></tr><tr class="table-odd"><td>swswitchUserUrl</td><td>switchUser.switchUserUrl</td></tr><tr class="table-even"><td>swexitUserUrl</td><td>switchUser.exitUserUrl</td></tr><tr class="table-odd"><td>swtargetUrl</td><td>switchUser.targetUrl</td></tr><tr class="table-even"><td>useMail</td><td>N/A - registration will be supported in the UI plugin</td></tr><tr class="table-odd"><td>mailHost</td><td>N/A - registration will be supported in the UI plugin</td></tr><tr class="table-even"><td>mailUsername</td><td>N/A - registration will be supported in the UI plugin</td></tr><tr class="table-odd"><td>mailPassword</td><td>N/A - registration will be supported in the UI plugin</td></tr><tr class="table-even"><td>mailProtocol</td><td>N/A - registration will be supported in the UI plugin</td></tr><tr class="table-odd"><td>mailFrom</td><td>N/A - registration will be supported in the UI plugin</td></tr><tr class="table-even"><td>mailPort</td><td>N/A - registration will be supported in the UI plugin</td></tr><tr class="table-odd"><td>defaultRole</td><td>N/A - registration will be supported in the UI plugin</td></tr><tr class="table-even"><td>useOpenId</td><td>N/A - will be supported in the OpenID plugin</td></tr><tr class="table-odd"><td>openIdNonceMaxSeconds</td><td>N/A - will be supported in the OpenID plugin</td></tr><tr class="table-even"><td>useLdap</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-odd"><td>ldapRetrieveGroupRoles</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-even"><td>ldapRetrieveDatabaseRoles</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-odd"><td>ldapSearchSubtree</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-even"><td>ldapGroupRoleAttribute</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-odd"><td>ldapPasswordAttributeName</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-even"><td>ldapServer</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-odd"><td>ldapManagerDn</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-even"><td>ldapManagerPassword</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-odd"><td>ldapSearchBase</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-even"><td>ldapSearchFilter</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-odd"><td>ldapGroupSearchBase</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-even"><td>ldapGroupSearchFilter</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-odd"><td>ldapUsePassword</td><td>N/A - will be supported in the LDAP plugin</td></tr><tr class="table-even"><td>useKerberos</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-odd"><td>kerberosLoginConfigFile</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-even"><td>kerberosRealm</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-odd"><td>kerberosKdc</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-even"><td>kerberosRetrieveDatabaseRoles</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-odd"><td>useHttpSessionEventPublisher</td><td>useHttpSessionEventPublisher</td></tr><tr class="table-even"><td>cacheUsers</td><td>cacheUsers</td></tr><tr class="table-odd"><td>useCAS</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-even"><td>cas.casServer</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-odd"><td>cas.casServerPort</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-even"><td>cas.casServerSecure</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-odd"><td>cas.localhostSecure</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-even"><td>cas.failureURL</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-odd"><td>cas.defaultTargetURL</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-even"><td>cas.fullLoginURL</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-odd"><td>cas.fullServiceURL</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-even"><td>cas.authenticationProviderKey</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-odd"><td>cas.userDetailsService</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-even"><td>cas.sendRenew</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-odd"><td>cas.proxyReceptorUrl</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-even"><td>cas.filterProcessesUrl</td><td>N/A - will be supported in the CAS plugin</td></tr><tr class="table-odd"><td>useNtlm</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-even"><td>ntlm.stripDomain</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-odd"><td>ntlm.retryOnAuthFailure</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-even"><td>ntlm.forceIdentification</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-odd"><td>ntlm.defaultDomain</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-even"><td>ntlm.netbiosWINS</td><td>N/A - will be supported in a secondary plugin</td></tr><tr class="table-odd"><td>httpPort</td><td>portMapper.httpPort</td></tr><tr class="table-even"><td>httpsPort</td><td>portMapper.httpsPort</td></tr><tr class="table-odd"><td>secureChannelDefinitionSource</td><td>N/A, use secureChannel.definition</td></tr><tr class="table-even"><td>channelConfig</td><td>secureChannel.definition</td></tr><tr class="table-odd"><td>ipRestrictions</td><td>ipRestrictions</td></tr><tr class="table-even"><td>useFacebook</td><td>N/A - will be supported in the Facebook plugin</td></tr><tr class="table-odd"><td>facebook.filterProcessesUrl</td><td>N/A - will be supported in the Facebook plugin</td></tr><tr class="table-even"><td>facebook.authenticationUrlRoot</td><td>N/A - will be supported in the Facebook plugin</td></tr><tr class="table-odd"><td>facebook.apiKey</td><td>N/A - will be supported in the Facebook plugin</td></tr><tr class="table-even"><td>facebook.secretKey</td><td>N/A - will be supported in the Facebook plugin</td></tr></table><p class="paragraph"/><h4>Comparing Script Differences</h4><p class="paragraph"/>To initialize the Acegi plugin, you run the <code>create-auth-domains</code>. This initialization creates <code>grails-app/conf/SecurityConfig.groovy</code> to allow configuration customization; creates the User, Role, and Requestmap domain classes; and creates the Login and Logout controllers and views. Another Acegi script, <code>generate-manager</code>, creates CRUD pages for the domain classes. (The earlier version of Grails did not scaffold many-to-many relationships well, so these GSPs were necessary.)In addition, a <code>generate-registration</code> script installs a basic user registration controller.<p class="paragraph"/>
The Spring Security plugin uses only one script, <a href="../ref/Scripts/s2-quickstart.html" class="Scripts">s2-quickstart</a>. It is similar to <code>create-auth-domains</code> because it creates domain classes and login and logout bcontrollers, but it appends files to <code>grails-app/conf/Config.groovy</code> instead of creating a standalone configuration file. There is no equivalent to <code>generate-manager</code> or <code>generate-registration</code> because an optional UI plugin will generate domain class management screens, an admin console, and forgot password and registration workflows. If you want to create your own CRUD pages you can use the standard Grails <code>generate-all</code> script. Various sections of this documentation discuss required changes to the generated source files, for example, encrypting passwords before saving or updating a user.<p class="paragraph"/><h4>domainClass Differences</h4><p class="paragraph"/>The Acegi plugin extends the <code>UserDetails</code> instance and adds an accessor for the person domain class instance that is used to populate the <code>UserDetails</code>. Because the <code>Authentication</code> is kept in the HTTP session and the <code>UserDetails</code> is attached to that, it is easy to access non-security data such as full name, email, and so on without hitting the database.<p class="paragraph"/>
However, with this approach, if the domain class has a lot of data, you increase the size of the session payload, which is exacerbated by clustered sessions. Further, any lazy-loaded collections fail to load after retrieving the person from the session because it would have become a detached Hibernate object. This problem is fixed by calling person.attach() or by reloading by id, for example:<p class="paragraph"/><div class="code"><pre>def userDetails = authenticateService.principal()
def person = userDetails.domainClass
person = Person.get(person.id)</pre></div><p class="paragraph"/>But with this approach, the person is essentially a very large wrapper around its primary key since that's the real data you're storing.<p class="paragraph"/>To resolve this issue, the Spring Security plugin does not store the domain class but instead stores the id so you can retrieve the person easily:<p class="paragraph"/><div class="code"><pre>def userDetails = springSecurityService.principal
person = Person.get(userDetails.id)</pre></div><p class="paragraph"/>This approach works because the <code>UserDetails</code> implementation is an instance of <code>org.codehaus.groovy.grails.plugins.springsecurity.GrailsUser</code>, which extends the standard Spring Security <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/core/userdetails/User.html" target="blank">User</a> and adds a <code>getId()</code> method.<p class="paragraph"/>You can further extend this class if you want to store more data along with the authentication to avoid database access. See <a href="../guide/single.html#7. Custom UserDetailsService" class="guide">Custom UserDetailsService</a>.<p class="paragraph"/>
    
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker('UA-16219500-1');
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
