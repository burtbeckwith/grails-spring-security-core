<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>3. Securing URLs</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    There are three ways to configure request mappings to secure application URLs. The goal is to create a mapping of URL patterns to the roles required to access those URLs. Use whichever approach makes the most sense for you. The three approaches are:
<ul class="star">
<li><code>&#64;Secured</code> annotations</li>
<li>a simple Map in <code>Config.groovy</code></li>
<li><code>Requestmap</code> domain class instances stored in the database</li>
</ul><p class="paragraph"/>and the default approach is to use annotations. You can only use one method at a time, and it's configured with the <code>securityConfigType</code> attribute; the value has to be an <code>SecurityConfigType</code> enum value.<p class="paragraph"/>To use annotations, specify <code>SecurityConfigType.Annotation</code> (or leave it unspecified since it's the default):<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugins.springsecurity.SecurityConfigType<p class="paragraph"/>...<p class="paragraph"/>grails.plugins.springsecurity.securityConfigType = SecurityConfigType.Annotation</pre></div><p class="paragraph"/>To use the <code>Config.groovy</code> Map, specify <code>SecurityConfigType.InterceptUrlMap</code>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugins.springsecurity.SecurityConfigType<p class="paragraph"/>...<p class="paragraph"/>grails.plugins.springsecurity.securityConfigType = SecurityConfigType.InterceptUrlMap</pre></div><p class="paragraph"/>To use <code>Requestmap</code> entries, specify <code>SecurityConfigType.Requestmap</code>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugins.springsecurity.SecurityConfigType<p class="paragraph"/>...<p class="paragraph"/>grails.plugins.springsecurity.securityConfigType = SecurityConfigType.Requestmap</pre></div><p class="paragraph"/>In addition, you can use a pessimistic 'lockdown' approach if you like. Most applications are mostly public, with some pages only accessible to authenticated users with various roles. Here it makes more sense to leave URLs open by default and restrict access one a case-by-case basis. But if your app is primarily secure, you can deny access to all URLs that don't have an applicable URL-Role configuration.<p class="paragraph"/>To use the pessimistic approach, add this to <code>grails-app/conf/Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails.plugins.springsecurity.rejectIfNoRule = <span class="java&#45;keyword">true</span></pre></div><p class="paragraph"/>and any requested URL that doesn't have a corresponding rule will be denied to all users.<p class="paragraph"/><h4>URLs and authorities</h4><p class="paragraph"/>In each approach you configure a mapping for a URL pattern to the role(s) that are required to access those URLs, e.g. <code>/admin/user/&#42;&#42;</code> requires <code>ROLE_ADMIN</code>. In addition, you can combine the role(s) with tokens such as IS_AUTHENTICATED_ANONYMOUSLY, IS_AUTHENTICATED_REMEMBERED, and IS_AUTHENTICATED_FULLY. One or more <code>Voter</code>s will process any tokens and enforce a rule based on them:
<ul class="star">
<li><code>IS_AUTHENTICATED_ANONYMOUSLY</code></li>
<ul class="star">
<li>signifies that anyone can access this URL; by default the <code>AnonymousAuthenticationFilter</code> ensures that there's an 'anonymous' <code>Authentication</code> with no roles so every user has an authentication, so this token just requires any authentication, even anonymous</li>
</ul>
<li><code>IS_AUTHENTICATED_REMEMBERED</code></li>
<ul class="star">
<li>signifies that the user is authenticated via a remember-me cookie or an explicit login</li>
</ul>
<li><code>IS_AUTHENTICATED_FULLY</code></li>
<ul class="star">
<li>requires that the user be fully authenticated via an explicit login</li>
</ul></ul><p class="paragraph"/><code>IS_AUTHENTICATED_FULLY</code> is useful to implement a security scheme where you allow users to check a remember-me checkbox during login, and auto-authenticate them each time they come back to your site, but require them to login with a password for some parts of the site. For example regular browsing might be allowed and even adding items to a shopping cart with only a cookie, but checking out or viewing purchase history would require an explicit login.<p class="paragraph"/><h4>Advantages and disadvantages</h4><p class="paragraph"/>Each approach has its advantages and disadvantages. Annotations and the <code>Config.groovy</code> Map are less flexible since they're configured once in the code and can only be updated by restarting the application (in prod mode anyway). In practice this isn't that serious a concern since for most applications security mappings are unlikely to change at runtime.<p class="paragraph"/>If you want runtime-configurability then storing <code>Requestmap</code> entries enables this. This allows you to have a core set of rules populated at application startup and to edit, add, and delete them whenever you like. But it separates the security rules from the application code, which is less convenient than having the rules defined in <code>grails-app/conf/Config.groovy</code> or in the applicable controllers using annotations.<p class="paragraph"/><h4>Some notes</h4>
<ul class="star">
<li>to understand the meaning of <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, and <code>IS_AUTHENTICATED_ANONYMOUSLY</code>, see the Javadoc for <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/access/vote/AuthenticatedVoter.html" target="blank">AuthenticatedVoter</a></li>
<li>URLs must be mapped in lowercase if using the <code>Requestmap</code> or <code>grails-app/conf/Config.groovy</code> map approaches, so for example if you have a FooBarController, its urls will be of the form /fooBar/list, /fooBar/create, etc. but these must be mapped as /foobar/, /foobar/list, /foobar/create. This is handled automatically for you if you use annotations.</li>
</ul><p class="paragraph"/>
    </body>
</html>
