<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>5.3 Requestmap Instances Stored in the Database</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    With this approach you use the <code>Requestmap</code> domain class to store mapping entries in the database. <code>Requestmap</code> has a <code>url</code> property that contains the secured URL pattern and a <code>configAttribute</code> property containing a comma-delimited list of required roles and/or tokens such as <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, and <code>IS_AUTHENTICATED_ANONYMOUSLY</code>.<p class="paragraph"/>To use <code>Requestmap</code> entries, specify <code>securityConfigType="Requestmap"</code>:<p class="paragraph"/><div class="code"><pre>grails.plugins.springsecurity.securityConfigType = <span class="java&#45;quote">"Requestmap"</span></pre></div><p class="paragraph"/>You create <code>Requestmap</code> entries as you create entries in any Grails domain class:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Requestmap(url: '/js/&#42;&#42;', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/css/&#42;&#42;', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/images/&#42;&#42;', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/login/&#42;&#42;', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/logout/&#42;&#42;', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/&#42;', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/profile/&#42;&#42;', configAttribute: 'ROLE_USER').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/admin/&#42;&#42;', configAttribute: 'ROLE_ADMIN').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/admin/role/&#42;&#42;', configAttribute: 'ROLE_SUPERVISOR').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/admin/user/&#42;&#42;', configAttribute: 'ROLE_ADMIN,ROLE_SUPERVISOR').save()
<span class="java&#45;keyword">new</span> Requestmap(url: '/j_spring_security_switch_user',
               configAttribute: 'ROLE_SWITCH_USER,IS_AUTHENTICATED_FULLY').save()</pre></div><p class="paragraph"/>The <code>configAttribute</code> value can have a single value or have multiple comma-delimited values. In this example only users with <code>ROLE_ADMIN</code> or <code>ROLE_SUPERVISOR</code> can access <code>/admin/user/&#42;&#42;</code> urls, and only users with <code>ROLE_SWITCH_USER</code> can access the switch-user url (<code>/j_spring_security_switch_user</code>) and in addition must be authenticated fully, i.e. not using a remember-me cookie. Note that when specifying multiple roles, the user must have at least one of them, but when combining <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, or <code>IS_AUTHENTICATED_ANONYMOUSLY</code> with one or more roles means the user must have one of the roles and satisty the <code>IS_AUTHENTICATED</code> rule.<p class="paragraph"/>Unlike the <a href="../guide/single.html#5.2 Simple Map in Config.groovy" class="guide">Config.groovy Map approach</a>, you do not need to revise the <code>Requestmap</code> entry order because the plugin calculates the most specific rule that applies to the current request.<p class="paragraph"/><h4>Requestmap Cache</h4><p class="paragraph"/><code>Requestmap</code> entries are cached for performance, but caching affects runtime configurability. If you create, edit, or delete an instance, the cache must be flushed and repopulated to be consistent with the database. You can call <code>springSecurityService.clearCachedRequestmaps()</code> to do this. For example, if you create a <code>RequestmapController</code> the <code>save</code> action should look like this (and the update and delete actions should similarly call <code>clearCachedRequestmaps()</code>):<p class="paragraph"/><div class="code"><pre>class RequestmapController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   ...<p class="paragraph"/>   def save = &#123;
      def requestmapInstance = <span class="java&#45;keyword">new</span> Requestmap(params)
      <span class="java&#45;keyword">if</span> (!requestmapInstance.save(flush: <span class="java&#45;keyword">true</span>)) &#123;
         render view: 'create', model: &#91;requestmapInstance: requestmapInstance&#93;
         <span class="java&#45;keyword">return</span>
      &#125;<p class="paragraph"/>      springSecurityService.clearCachedRequestmaps()
      flash.message = <span class="java&#45;quote">"$&#123;message(code: '<span class="java&#45;keyword">default</span>.created.message', args: &#91;message(code: 'requestmap.label', <span class="java&#45;keyword">default</span>: 'Requestmap'), requestmapInstance.id&#93;)&#125;"</span>
      redirect action: show, id: requestmapInstance.id
   &#125;
&#125;</pre></div>

    
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16219500-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body>
</html>
