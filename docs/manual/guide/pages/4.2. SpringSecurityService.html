<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>4.2. SpringSecurityService</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    <code>grails.plugins.springsecurity.SpringSecurityService</code> provides security utility functions. It's a regular Grails service, so you can use dependency injection to inject it into a controller, service, taglib, etc.:<p class="paragraph"/><div class="code"><pre>def springSecurityService</pre></div><p class="paragraph"/><h4>isLoggedIn()</h4><p class="paragraph"/>Checks to see if there's a currently logged-in user.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class SomeController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   def someAction = &#123;
      <span class="java&#45;keyword">if</span> (springSecurityService.isLoggedIn()) &#123;
         &#8230;
      &#125;
      <span class="java&#45;keyword">else</span> &#123;
         &#8230;
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>getAuthentication()</h4><p class="paragraph"/>Retrieves the current user's <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/core/Authentication.html" target="blank">Authentication</a> if logged in, or <code>null</code> otherwise.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class SomeController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   def someAction = &#123;
      def auth = springSecurityService.authentication
      <span class="java&#45;object">String</span> username = auth.username
      def authorities = auth.authorities // a Collection of GrantedAuthority
      <span class="java&#45;object">boolean</span> authenticated = auth.authenticated
      &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>getPrincipal()</h4><p class="paragraph"/>Retrieves the currently logged in user's <code>Principal</code>, or <code>null</code> if not logged in. This will be a <code>org.codehaus.groovy.grails.plugins.springsecurity.GrailsUser</code> unless you've created a custom <code>UserDetailsService</code>, in which case it'll be whatever implementation of <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/core/userdetails/UserDetails.html" target="blank">UserDetails</a> you use there.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class SomeController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   def someAction = &#123;
      def principal = springSecurityService.principal
      <span class="java&#45;object">String</span> username = principal.username
      def authorities = principal.authorities // a Collection of GrantedAuthority
      <span class="java&#45;object">boolean</span> enabled = principal.enabled
      &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>encodePassword()</h4><p class="paragraph"/>Encrypts a password using the configured encryption scheme. By default the plugin uses SHA-256, but this is configurable using the <code>grails.plugins.springsecurity.password.algorithm</code> attribute in <code>Config.groovy</code>. You can use any message digest algorithm that's supported in your JDK; see <a href="http://java.sun.com/j2se/1.5.0/docs/guide/security/CryptoSpec.html#AppA" target="blank">this page</a> for information on what's available. In particular you are <strong class="bold">strongly</strong> discouraged from using MD5 or SHA-1 algorithms since they are rather weak and have well-known vulnerabilities. You should also use a salt for your passwords, which greatly increases the computational complexity of decrypting passwords if your database gets compromised. See <a href="../guide/single.html#10.5. Salted passwords" class="guide">here</a> for details on using salted passwords.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class PersonController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   def updateAction = &#123;
      def person = Person.get(params.id)<p class="paragraph"/>      params.salt = person.salt
      <span class="java&#45;keyword">if</span> (person.password != params.password) &#123;
         params.password = springSecurityService.encodePassword(password, salt)
         def salt = &#8230; // e.g. randomly generated using some utility method
         params.salt = salt
      &#125;
      person.properties = params
      <span class="java&#45;keyword">if</span> (!person.save(flush: <span class="java&#45;keyword">true</span>)) &#123;
         render view: 'edit', model: &#91;person: person&#93;
         <span class="java&#45;keyword">return</span>
      &#125;
      redirect action: show, id: person.id
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>updateRole()</h4><p class="paragraph"/>Updates a role and if you're using <code>Requestmap</code> instances to manage securing URLs, will replace the new role name in all <code>Requestmap</code> definitions that use it if the name was changed.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class RoleController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   def update = &#123;
      def roleInstance = Role.get(params.id)
      <span class="java&#45;keyword">if</span> (!springSecurityService.updateRole(roleInstance, params)) &#123;
         render view: 'edit', model: &#91;roleInstance: roleInstance&#93;
         <span class="java&#45;keyword">return</span>
      &#125;<p class="paragraph"/>      flash.message = <span class="java&#45;quote">"The role was updated"</span>
      redirect action: show, id: roleInstance.id
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>deleteRole()</h4><p class="paragraph"/>Deletes a role and if you're using <code>Requestmap</code> instances to manage securing URLs, will remove the role from all <code>Requestmap</code> definitions. If a <code>Requestmap</code>'s config attribute is just this role's name (e.g. "/foo/bar/<strong class="bold"></strong>=ROLE_FOO") it will be deleted.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class RoleController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   def delete = &#123;
      def roleInstance = Role.get(params.id)
      <span class="java&#45;keyword">try</span> &#123;
         springSecurityService.deleteRole (roleInstance
         flash.message = <span class="java&#45;quote">"The role was deleted"</span>
         redirect action: list
      &#125;
      <span class="java&#45;keyword">catch</span> (DataIntegrityViolationException e) &#123;
         flash.message = <span class="java&#45;quote">"Unable to delete the role"</span>
         redirect action: show, id: params.id
      &#125;
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>clearCachedRequestmaps()</h4><p class="paragraph"/>If you're using <code>Requestmap</code> instances to manage securing URLs, the plugin will load and cache all <code>Requestmap</code> instances as a performance optimization. This saves a lot of database activity since the requestmaps are checked for each request. But you can't allow the cache to become stale, so when you create, edit or delete a <code>Requestmap</code> you should flush the cache to trigger a complete reload. Both <code>updateRole()</code> and <code>deleteRole()</code> call this method for you, so you should call this when you create a new <code>Requestmap</code> or if you do some other <code>Requestmap</code> work that would affect the cache.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class RequestmapController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   def save = &#123;
      def requestmapInstance = <span class="java&#45;keyword">new</span> Requestmap(params)
      <span class="java&#45;keyword">if</span> (!requestmapInstance.save(flush: <span class="java&#45;keyword">true</span>)) &#123;
         render view: 'create', model: &#91;requestmapInstance: requestmapInstance&#93;
         <span class="java&#45;keyword">return</span>
      &#125;<p class="paragraph"/>      springSecurityService.clearCachedRequestmaps()
      flash.message = <span class="java&#45;quote">"Requestmap created"</span>
      redirect action: show, id: requestmapInstance.id
   &#125;
&#125;</pre></div><p class="paragraph"/><h4>reauthenticate()</h4><p class="paragraph"/>Rebuilds an <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/core/Authentication.html" target="blank">Authentication</a> for the given username and registers it in the security context. This is typically used after updating a user's authorities or other data that is cached in the <code>Authentication</code> or <code>Principal</code>. It slso removes the user from the user cache to force a refresh at next login.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class UserController &#123;<p class="paragraph"/>   def springSecurityService<p class="paragraph"/>   def update = &#123;
      def userInstance = User.get(params.id)<p class="paragraph"/>      params.salt = person.salt
      <span class="java&#45;keyword">if</span> (userInstance.password != params.password) &#123;
         params.password = springSecurityService.encodePassword(params.password, salt)
         def salt = &#8230; // e.g. randomly generated using some utility method
         params.salt = salt
      &#125;
      userInstance.properties = params
      <span class="java&#45;keyword">if</span> (!userInstance.save(flush: <span class="java&#45;keyword">true</span>)) &#123;
         render view: 'edit', model: &#91;userInstance: userInstance&#93;
         <span class="java&#45;keyword">return</span>
      &#125;<p class="paragraph"/>      <span class="java&#45;keyword">if</span> (springSecurityService.loggedIn &#38;&#38;
             springSecurityService.principal.username == userInstance.username) &#123;
         springSecurityService.reauthenticate userInstance.username
      &#125;<p class="paragraph"/>      flash.message = <span class="java&#45;quote">"The user was updated"</span>
      redirect action: show, id: userInstance.id
   &#125;
&#125;</pre></div><p class="paragraph"/>
    
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker('UA-16219500-1');
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
