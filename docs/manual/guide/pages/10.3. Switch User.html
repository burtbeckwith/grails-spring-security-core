<html><head><meta content='text/html; charset=utf-8' http-equiv='Content-type'></meta><title>10.3. Switch User</title><link title='Ref' charset='utf-8' rel='stylesheet' type='text/css' href='../css/main.css' media='screen'></link></head><body><body class='body'>
    To enable a user to switch from their current <code>Authentication</code> to another user's, set the <code>useSwitchUserFilter</code> attribute to <code>true</code>. This feature is similar to the 'su' command in Unix, for example to allow an admin to act as a regular user to perform some actions, and then switch back.<p class='paragraph'></p><blockquote class='warning'>
This is a very powerful feature since it allows you full access to whatever the switched-to user can access without knowing their password, so it's very important that you limit who can use this feature. The best way to do this is to guard the user switch URL with a role, e.g. <code>ROLE_SWITCH_USER</code>, <code>ROLE_ADMIN</code>, etc.
</blockquote><p class='paragraph'></p><h4>Switching to another user</h4><p class='paragraph'></p>To switch to another user, typically you would create a form that submits to <code>/j_spring_security_switch_user</code>:<p class='paragraph'></p><div class='code'><pre>&lt;sec:ifAllGranted roles='ROLE_SWITCH_USER'&gt;<p class='paragraph'></p>   &lt;form action='/j_spring_security_switch_user' method='POST'&gt;
      Switch to user: &lt;input type='text' name='j_username'/&gt; &lt;br/&gt;
      &lt;input type='submit' value='Switch'/&gt;
   &lt;/form&gt;<p class='paragraph'></p>&lt;/sec:ifAllGranted&gt;</pre></div><p class='paragraph'></p>Note that here the form is guarded by a check that the logged-in user has <code>ROLE_SWITCH_USER</code> and isn't shown otherwise. In addition you'll want to guard the user switch URL and the approach depends on which mapping scheme you're using. If you're using annotations, add a rule to the <code>controllerAnnotations.staticRules</code> attribute:<p class='paragraph'></p><div class='code'><pre>grails.plugins.springsecurity.controllerAnnotations.staticRules = [
   &#x2026;
   '/j_spring_security_switch_user': ['ROLE_SWITCH_USER', 'IS_AUTHENTICATED_FULLY']
]</pre></div><p class='paragraph'></p>If you're using <code>Requestmap</code>s, create one like this (e.g. in <code>BootStrap</code>):<p class='paragraph'></p><div class='code'><pre><span class='java-keyword'>new</span> Requestmap(url: '/j_spring_security_switch_user',
               configAttribute: 'ROLE_SWITCH_USER,IS_AUTHENTICATED_FULLY').save(flush: <span class='java-keyword'>true</span>)</pre></div><p class='paragraph'></p>and if you're using the <code>Config.groovy</code> map, add it there:<p class='paragraph'></p><div class='code'><pre>grails.plugins.springsecurity.interceptUrlMap = [
   &#x2026;
   '/j_spring_security_switch_user': ['ROLE_SWITCH_USER', 'IS_AUTHENTICATED_FULLY']
]</pre></div><p class='paragraph'></p><h4>Switching back</h4><p class='paragraph'></p>To resume as the original user, navigate to <code>/j_spring_security_exit_user</code>.<p class='paragraph'></p><div class='code'><pre>&lt;sec:ifSwitched&gt;
&lt;a href='${request.contextPath}/j_spring_security_exit_user'&gt;
   Resume as &lt;sec:switchedUserOriginalUsername/&gt;
&lt;/a&gt;
&lt;/sec:ifSwitched&gt;</pre></div><p class='paragraph'></p><h4>Configuration</h4><p class='paragraph'></p>In addition you can customize the URLs that are used for this feature, although this is rarely necessary:<p class='paragraph'></p><div class='code'><pre>grails.plugins.springsecurity.switchUser.switchUserUrl = &#x2026;
grails.plugins.springsecurity.switchUser.exitUserUrl = &#x2026;
grails.plugins.springsecurity.switchUser.targetUrl = &#x2026;
grails.plugins.springsecurity.switchUser.switchFailureUrl = ...</pre></div><p class='paragraph'></p><table cellpadding='0' class='wiki-table' border='0' cellspacing='0'><tr><th><strong class='bold'>Name</strong></th><th><strong class='bold'>Default</strong></th><th><strong class='bold'>Meaning</strong></th></tr><tr class='table-odd'><td>switchUser.switchUserUrl</td><td>'/j_spring_security_switch_user'</td><td>url to access (via GET or POST) to switch to another user</td></tr><tr class='table-even'><td>switchUser.exitUserUrl</td><td>'/j_spring_security_exit_user'</td><td>url to access to switch to another user</td></tr><tr class='table-odd'><td>switchUser.targetUrl</td><td>the same as <code>successHandler.defaultTargetUrl</code></td><td>the URL to redirect to after switching</td></tr><tr class='table-even'><td>switchUser.switchFailureUrl</td><td>the same as <code>failureHandler.defaultFailureUrl</code></td><td>the URL to redirect to after an error attempting to switch</td></tr></table><p class='paragraph'></p><h4>Example code</h4><p class='paragraph'></p>One approach to supporting this feature would be to add code to one or more of your GSP templates. In this example the current username is displayed, and if the user has switched from another (using the <code>sec:ifSwitched</code> tag) then a 'resume' link is displayed. If not, and the user has the required role, then a form is displayed to allow input of the username of the user to switch to:<p class='paragraph'></p><div class='code'><pre>&lt;sec:ifLoggedIn&gt;
Logged in as &lt;sec:username/&gt;
&lt;/sec:ifLoggedIn&gt;<p class='paragraph'></p>&lt;sec:ifSwitched&gt;
&lt;a href='${request.contextPath}/j_spring_security_exit_user'&gt;
   Resume as &lt;sec:switchedUserOriginalUsername/&gt;
&lt;/a&gt;
&lt;/sec:ifSwitched&gt;<p class='paragraph'></p>&lt;sec:ifNotSwitched&gt;
   &lt;sec:ifAllGranted roles='ROLE_SWITCH_USER'&gt;<p class='paragraph'></p>   &lt;form action='${request.contextPath}/j_spring_security_switch_user' method='POST'&gt;
      Switch to user: &lt;input type='text' name='j_username'/&gt;&lt;br/&gt;
      &lt;input type='submit' value='Switch'/&gt;
   &lt;/form&gt;<p class='paragraph'></p>   &lt;/sec:ifAllGranted&gt;
&lt;/sec:ifNotSwitched&gt;</pre></div><p class='paragraph'></p>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16219500-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body></html>