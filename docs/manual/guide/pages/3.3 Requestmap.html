<html><head><meta content='text/html; charset=utf-8' http-equiv='Content-type'></meta><title>3.3 Requestmap</title><link title='Ref' charset='utf-8' rel='stylesheet' type='text/css' href='../css/main.css' media='screen'></link></head><body><body class='body'>
    With this approach you store mapping entries in the database, using the <code>Requestmap</code> domain class. <code>Requestmap</code> has a <code>url</code> property which contains the secured URL pattern and a <code>configAttribute</code> property containing a comma-delimited list of required roles and/or tokens such as <code>IS_AUTHENTICATED_FULLY</code>, <code>IS_AUTHENTICATED_REMEMBERED</code>, and <code>IS_AUTHENTICATED_ANONYMOUSLY</code>.<p class='paragraph'></p>Creation of <code>Requestmap</code> entries is the same as for any Grails domain class:<p class='paragraph'></p><div class='code'><pre><span class='java-keyword'>new</span> Requestmap(url: '/js/**', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class='java-keyword'>new</span> Requestmap(url: '/css/**', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class='java-keyword'>new</span> Requestmap(url: '/images/**', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class='java-keyword'>new</span> Requestmap(url: '/login/**', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class='java-keyword'>new</span> Requestmap(url: '/logout/**', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class='java-keyword'>new</span> Requestmap(url: '/*', configAttribute: 'IS_AUTHENTICATED_ANONYMOUSLY').save()
<span class='java-keyword'>new</span> Requestmap(url: '/profile/**', configAttribute: 'ROLE_USER').save()
<span class='java-keyword'>new</span> Requestmap(url: '/admin/**', configAttribute: 'ROLE_ADMIN').save()
<span class='java-keyword'>new</span> Requestmap(url: '/admin/user/**', configAttribute: 'ROLE_SUPERVISOR').save()</pre></div><p class='paragraph'></p>Unlike the <code>Config.groovy</code> Map approach above, you don't need to worry about <code>Requestmap</code> entry order since the plugin calculates the most specific rule that applies to the current request.<p class='paragraph'></p><h4>Requestmap cache</h4><p class='paragraph'></p><code>Requestmap</code> entries are cached for performance, but this has an impact on runtime configurability. If you create, edit, or delete an instance, the cache must be flushed and repopulated to be consistent with the database. You can call <code>springSecurityService.clearCachedRequestmaps()</code> to do this. For example, if you create a <code>RequestmapController</code> the <code>save</code> action should look like this (and the update and delete actions should similarly call <code>clearCachedRequestmaps()</code>):<p class='paragraph'></p><div class='code'><pre>class RequestmapController {<p class='paragraph'></p>   def springSecurityService<p class='paragraph'></p>   ...<p class='paragraph'></p>   def save = {
      def requestmapInstance = <span class='java-keyword'>new</span> Requestmap(params)
      <span class='java-keyword'>if</span> (!requestmapInstance.save(flush: <span class='java-keyword'>true</span>)) {
         render view: 'create', model: [requestmapInstance: requestmapInstance]
         <span class='java-keyword'>return</span>
      }<p class='paragraph'></p>      springSecurityService.clearCachedRequestmaps()
      flash.message = <span class='java-quote'>"${message(code: '<span class='java-keyword'>default</span>.created.message', args: [message(code: 'requestmap.label', <span class='java-keyword'>default</span>: 'Requestmap'), requestmapInstance.id])}"</span>
      redirect action: show, id: requestmapInstance.id
   }
}</pre></div><p class='paragraph'></p>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16219500-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body></html>