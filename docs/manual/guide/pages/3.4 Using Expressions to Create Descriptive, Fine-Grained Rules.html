<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>3.4 Using Expressions to Create Descriptive, Fine-Grained Rules</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    Spring Security uses the <a href="http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/expressions.html" target="blank">Spring Expression Language (SpEL)</a>, which allows you to declare the rules for guarding URLs more descriptively than does the traditional approach, and also allows much more fine-grained rules. Where you traditionally would specify a list of role names and/or special tokens (for example, <code>IS_AUTHENTICATED_FULLY</code>), with <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/reference/el-access.html" target="blank">Spring Security&#39;s expression support</a>, you can instead use the embedded scripting language to define simple or complex access rules.<p class="paragraph"/>You can use expressions with any of the previously described approaches to securing application URLs. For example, consider this annotated controller:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">package</span> com.yourcompany.yourapp<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.plugins.springsecurity.Secured<p class="paragraph"/>class SecureController &#123;<p class="paragraph"/>   @Secured(&#91;<span class="java&#45;quote">"hasRole('ROLE_ADMIN')"</span>&#93;)
   def someAction = &#123;
      &#8230;
   &#125;<p class="paragraph"/>   @Secured(&#91;<span class="java&#45;quote">"authentication.name == 'ralph'"</span>&#93;)
   def someOtherAction = &#123;
      &#8230;
   &#125;
&#125;</pre></div><p class="paragraph"/>In this example, <code>someAction</code> requires <code>ROLE_ADMIN</code>, and <code>someOtherAction</code> requires that the user be logged in with username 'ralph'.<p class="paragraph"/>The corresponding <code>Requestmap</code>s would be<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Requestmap(url: <span class="java&#45;quote">"/secure/someAction"</span>,
               configAttribute: <span class="java&#45;quote">"hasRole('ROLE_ADMIN'"</span>).save()<p class="paragraph"/><span class="java&#45;keyword">new</span> Requestmap(url: <span class="java&#45;quote">"/secure/someOtherAction"</span>,
               configAttribute: <span class="java&#45;quote">"authentication.name == 'ralph'"</span>).save()</pre></div><p class="paragraph"/>and the corresponding static mappings would be<p class="paragraph"/><div class="code"><pre>grails.plugins.springsecurity.interceptUrlMap = &#91;
   '/secure/someAction':      &#91;<span class="java&#45;quote">"hasRole('ROLE_ADMIN'"</span>&#93;,
   '/secure/someOtherAction': &#91;<span class="java&#45;quote">"authentication.name == 'ralph'"</span>&#93;
&#93;</pre></div><p class="paragraph"/>The Spring Security docs have a <a href="http://static.springsource.org/spring-security/site/docs/3.0.x/reference/el-access.html#el-common-built-in" target="blank">table listing the standard expressions</a>, which is copied here for reference:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Expression</strong></th><th><strong class="bold">Description</strong></th></tr><tr class="table-odd"><td><code>hasRole(role)</code></td><td>Returns true if the current principal has the specified role.</td></tr><tr class="table-even"><td><code>hasAnyRole(role1,role2)</code></td><td>Returns true if the current principal has any of the supplied roles (given as a comma-separated list of strings)</td></tr><tr class="table-odd"><td><code>principal</code></td><td>Allows direct access to the principal object representing the current user</td></tr><tr class="table-even"><td><code>authentication</code></td><td>Allows direct access to the current Authentication object obtained from the SecurityContext</td></tr><tr class="table-odd"><td><code>permitAll</code></td><td>Always evaluates to true</td></tr><tr class="table-even"><td><code>denyAll</code></td><td>Always evaluates to false</td></tr><tr class="table-odd"><td><code>isAnonymous()</code></td><td>Returns true if the current principal is an anonymous user</td></tr><tr class="table-even"><td><code>isRememberMe()</code></td><td>Returns true if the current principal is a remember-me user</td></tr><tr class="table-odd"><td><code>isAuthenticated()</code></td><td>Returns true if the user is not anonymous</td></tr><tr class="table-even"><td><code>isFullyAuthenticated()</code></td><td>Returns true if the user is not an anonymous or a remember-me user</td></tr></table><p class="paragraph"/>In addition, you can use a web-specific expression <code>hasIpAddress</code>. However, you may find it more convenient to separate IP restrictions from role restrictions by using the <a href="../guide/single.html#10.8. IP Address Restrictions" class="guide">IP address filter</a>.<p class="paragraph"/>To help migrate traditional configurations to expressions, here's a table comparing various configurations and their corresponding expressions:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Traditional</strong></th><th><strong class="bold">Expression</strong></th></tr><tr class="table-odd"><td><code>ROLE_ADMIN</code></td><td><code>hasRole('ROLE_USER')</code></td></tr><tr class="table-even"><td><code>ROLE_USER,ROLE_ADMIN</code></td><td><code>hasAnyRole('ROLE_USER,ROLE_ADMIN')</code></td></tr><tr class="table-odd"><td><code>ROLE_ADMIN,IS_AUTHENTICATED_FULLY</code></td><td><code>hasRole('ROLE_ADMIN') and isFullyAuthenticated()</code></td></tr><tr class="table-even"><td><code>IS_AUTHENTICATED_ANONYMOUSLY</code></td><td><code>permitAll</code></td></tr><tr class="table-odd"><td><code>IS_AUTHENTICATED_REMEMBERED</code></td><td><code>isAnonymous() or isRememberMe()</code></td></tr><tr class="table-even"><td><code>IS_AUTHENTICATED_FULLY</code></td><td><code>isFullyAuthenticated()</code></td></tr></table><p class="paragraph"/>
    
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker('UA-16219500-1');
pageTracker._trackPageview();
} catch(err) {}
</script>
</body>
</html>
