<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>15 Switch User</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    <h1><a name="15 Switch User">15 Switch User</a></h1>To enable a user to switch from the current <code>Authentication</code> to another user's, set the <code>useSwitchUserFilter</code> attribute to <code>true</code>. This feature is similar to the 'su' command in Unix. It enables, for example, an admin to act as a regular user to perform some actions, and then switch back.<p class="paragraph"/><blockquote class="warning">
This feature is very powerful; it allows full access to everything the switched-to user can access without requiring the user's password. Limit who can use this feature by guarding the user switch URL with a role, for example, <code>ROLE_SWITCH_USER</code>, <code>ROLE_ADMIN</code>, and so on.
</blockquote><p class="paragraph"/><h4>Switching to Another User</h4><p class="paragraph"/>To switch to another user, typically you create a form that submits to <code>/j_spring_security_switch_user</code>:<p class="paragraph"/><div class="code"><pre>&#60;sec:ifAllGranted roles='ROLE_SWITCH_USER'&#62;<p class="paragraph"/>   &#60;form action='/j_spring_security_switch_user' method='POST'&#62;
      Switch to user: &#60;input type='text' name='j_username'/&#62; &#60;br/&#62;
      &#60;input type='submit' value='Switch'/&#62;
   &#60;/form&#62;<p class="paragraph"/>&#60;/sec:ifAllGranted&#62;</pre></div><p class="paragraph"/>Here the form is guarded by a check that the logged-in user has <code>ROLE_SWITCH_USER</code> and is not shown otherwise. You also need to guard the user switch URL, and the approach depends on your mapping scheme. If you use annotations, add a rule to the <code>controllerAnnotations.staticRules</code> attribute:<p class="paragraph"/><div class="code"><pre>grails.plugins.springsecurity.controllerAnnotations.staticRules = &#91;
   &#8230;
   '/j_spring_security_switch_user': &#91;'ROLE_SWITCH_USER', 'IS_AUTHENTICATED_FULLY'&#93;
&#93;</pre></div><p class="paragraph"/>If you use <code>Requestmap</code>s, create a rule like this (for example, in <code>BootStrap</code>):<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Requestmap(url: '/j_spring_security_switch_user',
               configAttribute: 'ROLE_SWITCH_USER,IS_AUTHENTICATED_FULLY').save(flush: <span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/>If you use the <code>Config.groovy</code> map, add the rule there:<p class="paragraph"/><div class="code"><pre>grails.plugins.springsecurity.interceptUrlMap = &#91;
   &#8230;
   '/j_spring_security_switch_user': &#91;'ROLE_SWITCH_USER', 'IS_AUTHENTICATED_FULLY'&#93;
&#93;</pre></div><p class="paragraph"/><h4>Switching Back to Original User</h4>
To resume as the original user, navigate to <code>/j_spring_security_exit_user</code>.<p class="paragraph"/><div class="code"><pre>&#60;sec:ifSwitched&#62;
&#60;a href='$&#123;request.contextPath&#125;/j_spring_security_exit_user'&#62;
   Resume as &#60;sec:switchedUserOriginalUsername/&#62;
&#60;/a&#62;
&#60;/sec:ifSwitched&#62;</pre></div><p class="paragraph"/><h4>Customizing URLs</h4>
You can customize the URLs that are used for this feature, although it is rarely necessary:<p class="paragraph"/><div class="code"><pre>grails.plugins.springsecurity.switchUser.switchUserUrl = &#8230;
grails.plugins.springsecurity.switchUser.exitUserUrl = &#8230;
grails.plugins.springsecurity.switchUser.targetUrl = &#8230;
grails.plugins.springsecurity.switchUser.switchFailureUrl = ...</pre></div><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Property</strong></th><th><strong class="bold">Default</strong></th><th><strong class="bold">Meaning</strong></th></tr><tr class="table-odd"><td>useSwitchUserFilter</td><td><code>false</code></td><td>Whether to use the switch user filter.</td></tr><tr class="table-even"><td>switchUser.switchUserUrl</td><td>'/j_spring_security_switch_user'</td><td>URL to access (via GET or POST) to switch to another user.</td></tr><tr class="table-odd"><td>switchUser.exitUserUrl</td><td>'/j_spring_security_exit_user'</td><td>URL to access to switch to another user.</td></tr><tr class="table-even"><td>switchUser.targetUrl</td><td>Same as <code>successHandler.defaultTargetUrl</code></td><td>URL for redirect after switching.</td></tr><tr class="table-odd"><td>switchUser.switchFailureUrl</td><td>Same as <code>failureHandler.defaultFailureUrl</code></td><td>URL for redirect after an error during an attempt to switch.</td></tr></table><p class="paragraph"/><h4>GSP Code</h4><p class="paragraph"/>One approach to supporting the switch user feature is to add code to one or more of your GSP templates. In this example the current username is displayed, and if the user has switched from another (using the <code>sec:ifSwitched</code> tag) then a 'resume' link is displayed. If not, and the user has the required role, a form is displayed to allow input of the username to switch to:<p class="paragraph"/><div class="code"><pre>&#60;sec:ifLoggedIn&#62;
Logged in as &#60;sec:username/&#62;
&#60;/sec:ifLoggedIn&#62;<p class="paragraph"/>&#60;sec:ifSwitched&#62;
&#60;a href='$&#123;request.contextPath&#125;/j_spring_security_exit_user'&#62;
   Resume as &#60;sec:switchedUserOriginalUsername/&#62;
&#60;/a&#62;
&#60;/sec:ifSwitched&#62;<p class="paragraph"/>&#60;sec:ifNotSwitched&#62;
   &#60;sec:ifAllGranted roles='ROLE_SWITCH_USER'&#62;<p class="paragraph"/>   &#60;form action='$&#123;request.contextPath&#125;/j_spring_security_switch_user' method='POST'&#62;
      Switch to user: &#60;input type='text' name='j_username'/&#62;&#60;br/&#62;
      &#60;input type='submit' value='Switch'/&#62;
   &#60;/form&#62;<p class="paragraph"/>   &#60;/sec:ifAllGranted&#62;
&#60;/sec:ifNotSwitched&#62;</pre></div>

    
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-16219500-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
</body>
</html>
